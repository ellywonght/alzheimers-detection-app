(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{301:function(e,t,a){e.exports=a(331)},309:function(e,t,a){},310:function(e,t,a){},315:function(e,t){},316:function(e,t){},324:function(e,t){},325:function(e,t){},326:function(e,t){},327:function(e,t){},329:function(e,t,a){},330:function(e,t,a){},331:function(e,t,a){"use strict";a.r(t);var n=a(4),r=a.n(n),l=a(274),c=a.n(l);a(309),a(310);var o=function(e){let{setCurrentTest:t}=e;return r.a.createElement("div",{className:"home-container"},r.a.createElement("h2",null,"\u9078\u64c7\u6e2c\u8a66\u985e\u578b"),r.a.createElement("div",{className:"test-options"},r.a.createElement("div",{className:"test-card",onClick:()=>t("language")},r.a.createElement("h3",null,"\u8a9e\u8a00\u7406\u89e3\u6e2c\u8a66"),r.a.createElement("p",null,"\u8a55\u4f30\u8a9e\u8a00\u7406\u89e3\u548c\u8655\u7406\u80fd\u529b")),r.a.createElement("div",{className:"test-card",onClick:()=>t("hand")},r.a.createElement("h3",null,"\u53cd\u61c9\u901f\u5ea6\u6e2c\u8a66"),r.a.createElement("p",null,"\u8a55\u4f30\u624b\u90e8\u52d5\u4f5c\u5354\u8abf\u548c\u53cd\u61c9\u6642\u9593")),r.a.createElement("div",{className:"test-card",onClick:()=>t("realEye")},r.a.createElement("h3",null,"\u771f\u5be6\u773c\u7403\u8ffd\u8e64\u6e2c\u8a66"),r.a.createElement("p",null,"\u4f7f\u7528 MediaPipe FaceMesh \u8a55\u4f30\u773c\u52d5\u53c3\u6578")),r.a.createElement("div",{className:"test-card",onClick:()=>t("pupil")},r.a.createElement("h3",null,"\u77b3\u5b54\u5149\u53cd\u61c9\u6e2c\u8a66"),r.a.createElement("p",null,"\u6e2c\u91cf\u77b3\u5b54\u7684\u64f4\u5f35\u8207\u6536\u7e2e"))))},s=a(248),i=a(296);var u=function(e){let{results:t,onReset:a}=e;return r.a.createElement("div",{className:"results-container"},r.a.createElement("h2",null,"\u8a9e\u8a00\u80fd\u529b\u5206\u6790\u7d50\u679c"),r.a.createElement("div",{className:"score-summary"},r.a.createElement("div",{className:"score-circle"},r.a.createElement("span",null,t.overallScore,"%")),r.a.createElement("p",null,"\u6574\u9ad4\u8a8d\u77e5\u8a9e\u8a00\u529f\u80fd")),r.a.createElement("div",{className:"metrics-grid"},r.a.createElement("div",{className:"metric"},r.a.createElement("h3",null,"\u8a9e\u7fa9\u7406\u89e3"),r.a.createElement("div",{className:"metric-bar"},r.a.createElement("div",{className:"metric-fill",style:{width:`${t.semanticUnderstanding}%`}})),r.a.createElement("span",null,t.semanticUnderstanding,"%")),r.a.createElement("div",{className:"metric"},r.a.createElement("h3",null,"\u8a5e\u5f59\u6aa2\u7d22"),r.a.createElement("div",{className:"metric-bar"},r.a.createElement("div",{className:"metric-fill",style:{width:`${t.wordRetrieval}%`}})),r.a.createElement("span",null,t.wordRetrieval,"%"))),r.a.createElement("div",{className:"analysis-box"},r.a.createElement("h3",null,"DistilBERT \u5206\u6790"),r.a.createElement("p",null,t.analysis)),r.a.createElement("button",{className:"submit-button",onClick:a},"\u8fd4\u56de\u6e2c\u8a66"))};var m=function(e){let{setCurrentTest:t}=e;const[a,l]=Object(n.useState)(null),[c,o]=Object(n.useState)(!1),[m,d]=Object(n.useState)(!0),[g,p]=Object(n.useState)({}),[h,E]=Object(n.useState)(null),b=[{id:"q1",text:"\u5f9e\u4ee5\u4e0b\u9078\u9805\u4e2d\uff0c\u9078\u51fa\u8207\u5176\u4ed6\u4e09\u500b\u8a5e\u8a9e\u4e0d\u5c6c\u65bc\u540c\u4e00\u985e\u5225\u7684\u9078\u9805\uff1a",options:[{id:"q1a",text:"\u860b\u679c"},{id:"q1b",text:"\u9999\u8549"},{id:"q1c",text:"\u6a59"},{id:"q1d",text:"\u92fc\u7434"}],correctAnswer:"q1d"},{id:"q2",text:"\u5f9e\u4ee5\u4e0b\u9078\u9805\u4e2d\uff0c\u9078\u51fa\u8207\u5176\u4ed6\u4e09\u500b\u8a5e\u8a9e\u4e0d\u5c6c\u65bc\u540c\u4e00\u985e\u5225\u7684\u9078\u9805\uff1a",options:[{id:"q2a",text:"\u91ab\u751f"},{id:"q2b",text:"\u8b77\u58eb"},{id:"q2c",text:"\u98db\u6a5f"},{id:"q2d",text:"\u85e5\u5291\u5e2b"}],correctAnswer:"q2c"}];Object(n.useEffect)(()=>{!async function(){try{await s.a(),console.log("TensorFlow.js initialized");const t=await i.a();console.log("Universal Sentence Encoder loaded"),l(t),d(!1)}catch(e){console.error("Error loading model:",e)}}()},[]);const f=()=>{E(null),p({})},y=b.every(e=>g[e.id]);return h?r.a.createElement(u,{results:h,onReset:f}):r.a.createElement("div",{className:"test-container"},r.a.createElement("h2",null,"\u8a9e\u8a00\u80fd\u529b\u5206\u6790 (DistilBERT\u6280\u8853)"),m?r.a.createElement("div",{className:"loading-container"},r.a.createElement("p",null,"\u6b63\u5728\u52a0\u8f09 DistilBERT \u6a21\u578b\uff0c\u8acb\u7a0d\u5019...")):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"test-description"},"\u6b64\u6e2c\u8a66\u4f7f\u7528 DistilBERT \u81ea\u7136\u8a9e\u8a00\u8655\u7406\u6280\u8853\u5206\u6790\u60a8\u7684\u8a9e\u8a00\u80fd\u529b\u3002\u8acb\u56de\u7b54\u4ee5\u4e0b\u554f\u984c\uff0c\u7cfb\u7d71\u5c07\u5206\u6790\u60a8\u7684\u8a9e\u7fa9\u7406\u89e3\u80fd\u529b\u3002"),b.map(e=>r.a.createElement("div",{key:e.id,className:"question-container"},r.a.createElement("h3",null,e.text),r.a.createElement("div",{className:"options-grid"},e.options.map(t=>r.a.createElement("button",{key:t.id,className:`option-button ${g[e.id]===t.id?"selected":""}`,onClick:()=>((e,t)=>{p({...g,[e]:t})})(e.id,t.id)},t.text))))),r.a.createElement("button",{className:"submit-button",disabled:!y||c,onClick:async()=>{if(!a)return;o(!0);const e=b.filter(e=>g[e.id]===e.correctAnswer).length/b.length*100,t=b.map(e=>{const t=e.options.find(t=>t.id===g[e.id]);return t?t.text:""}).filter(Boolean);try{await a.embed(t);let r="";r=e>=90?"\u60a8\u7684\u8a9e\u8a00\u7406\u89e3\u80fd\u529b\u8868\u73fe\u512a\u79c0\u3002DistilBERT\u5206\u6790\u986f\u793a\u60a8\u5728\u8a9e\u7fa9\u95dc\u806f\u8fa8\u8b58\u548c\u8a5e\u8a9e\u9078\u64c7\u65b9\u9762\u8868\u73fe\u6b63\u5e38\uff0c\u6c92\u6709\u767c\u73fe\u8a9e\u8a00\u8655\u7406\u7570\u5e38\u8de1\u8c61\u3002":e>=50?"\u60a8\u7684\u8a9e\u8a00\u7406\u89e3\u80fd\u529b\u8868\u73fe\u826f\u597d\u3002DistilBERT\u5206\u6790\u986f\u793a\u60a8\u7684\u8a9e\u7fa9\u8655\u7406\u529f\u80fd\u6b63\u5e38\uff0c\u4f46\u5728\u67d0\u4e9b\u7d30\u5fae\u65b9\u9762\u6709\u8f15\u5fae\u504f\u5dee\uff0c\u5efa\u8b70\u5b9a\u671f\u9032\u884c\u8a8d\u77e5\u7df4\u7fd2\u3002":"\u60a8\u7684\u8a9e\u8a00\u7406\u89e3\u80fd\u529b\u8868\u73fe\u8f03\u5f31\u3002DistilBERT\u5206\u6790\u986f\u793a\u60a8\u5728\u8a9e\u7fa9\u8655\u7406\u65b9\u9762\u53ef\u80fd\u5b58\u5728\u56f0\u96e3\uff0c\u5efa\u8b70\u8aee\u8a62\u5c08\u696d\u91ab\u7642\u4eba\u54e1\u9032\u884c\u66f4\u5168\u9762\u7684\u8a55\u4f30\u3002",E({overallScore:Math.round(e),semanticUnderstanding:Math.round(e*(.9+.1*Math.random())),wordRetrieval:Math.round(e*(.85+.15*Math.random())),analysis:r})}catch(n){console.error("Error analyzing language:",n)}finally{o(!1)}}},c?"\u5206\u6790\u4e2d...":"\u63d0\u4ea4\u5206\u6790")))},d=a(164),g=a.n(d);a(328),a(160);var p=function(e){let{results:t,onReset:a}=e;(e=>{const t=Math.max(0,Math.min(100,100-(e-200)/6));Math.round(t)})(t.averageTime);const n=t.times||[],l=Math.max(...n,1);return r.a.createElement("div",{className:"results-container"},r.a.createElement("h2",null,"\u53cd\u61c9\u901f\u5ea6\u6e2c\u91cf\u7d50\u679c"),r.a.createElement("div",{className:"score-summary"},r.a.createElement("div",{className:"score-circle"},r.a.createElement("span",null,t.score,"%")),r.a.createElement("p",null,"\u624b\u90e8\u53cd\u61c9\u8868\u73fe")),r.a.createElement("div",{className:"metrics-grid"},r.a.createElement("div",{className:"metric"},r.a.createElement("h3",null,"\u5e73\u5747\u53cd\u61c9\u6642\u9593"),r.a.createElement("div",{className:"metric-value"},t.averageTime,"ms")),r.a.createElement("div",{className:"metric"},r.a.createElement("h3",null,"\u6700\u5feb\u53cd\u61c9\u6642\u9593"),r.a.createElement("div",{className:"metric-value"},t.bestTime,"ms"))),r.a.createElement("div",{className:"reaction-times-container"},r.a.createElement("h3",{style:{marginBottom:"20px"}},"\u53cd\u61c9\u6642\u9593\u8a18\u9304 (5\u6b21\u6e2c\u8a66)"),r.a.createElement("div",{className:"reaction-times-chart",style:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",margin:"20px 0 40px 0"}},n.map((e,t)=>{const a=e/l*200;return r.a.createElement("div",{key:t,className:"chart-column",style:{display:"flex",flexDirection:"column",alignItems:"center"}},r.a.createElement("div",{className:"reaction-time-bar",style:{position:"relative",width:"40px",height:`${a}px`,backgroundColor:e<400?"#5D5CDE":e<600?"#8C8BE6":"#ff9800",borderRadius:"4px 4px 0 0",transition:"height 0.3s"}},r.a.createElement("span",{className:"reaction-time-label",style:{position:"absolute",top:"-20px",width:"100%",textAlign:"center",fontSize:"12px",color:"#333"}},e,"ms")),r.a.createElement("div",{style:{marginTop:"8px",fontSize:"12px",color:"#6c757d",textAlign:"center"}},"\u6e2c\u8a66 ",t+1))}))),r.a.createElement("div",{className:"analysis-box"},r.a.createElement("h3",null,"MediaPipe Hands \u5206\u6790"),r.a.createElement("p",null,t.analysis),r.a.createElement("p",{className:"analysis-detail"},"\u53cd\u61c9\u6642\u9593\u548c\u624b\u90e8\u8ffd\u8e2a\u6e96\u78ba\u5ea6\u662f\u91cd\u8981\u7684\u904b\u52d5\u795e\u7d93\u529f\u80fd\u6307\u6a19\u3002\u65e9\u671f\u963f\u8332\u6d77\u9ed8\u75c7\u53ef\u80fd\u5f71\u97ff\u9019\u4e9b\u529f\u80fd\uff0c\u8868\u73fe\u70ba\u53cd\u61c9\u6642\u9593\u5ef6\u9577\u548c\u904b\u52d5\u5354\u8abf\u6027\u4e0b\u964d\u3002")),r.a.createElement("button",{className:"submit-button",onClick:a},"\u518d\u8a66\u4e00\u6b21"))};var h=function(e){let{setCurrentTest:t}=e;const a=Object(n.useRef)(null),[l,c]=Object(n.useState)(null),[o,i]=Object(n.useState)(!0),[u,m]=Object(n.useState)(!1),[d,h]=Object(n.useState)(!1),[E,b]=Object(n.useState)({x:0,y:0}),[f,y]=Object(n.useState)(!1),[v,x]=Object(n.useState)(!1),[w,C]=Object(n.useState)(null),[N,k]=Object(n.useState)([]),[D,j]=Object(n.useState)(0),[O,S]=Object(n.useState)(null),[R,T]=Object(n.useState)(!1),[G,B]=Object(n.useState)([]),[M,z]=Object(n.useState)(!0),[U,$]=Object(n.useState)(null),P=Object(n.useRef)(null),A=Object(n.useRef)(null),F=Object(n.useRef)(null);Object(n.useEffect)(()=>(async function(){try{await s.a(),i(!1)}catch(e){i(!1)}}(),()=>I()),[]);const I=()=>{P.current&&(clearTimeout(P.current),P.current=null),A.current&&(clearInterval(A.current),A.current=null),F.current&&(clearTimeout(F.current),F.current=null)};Object(n.useEffect)(()=>{!async function(){try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),m(!0)}catch(e){m(!1)}}()},[]);const W=()=>{var e,t,n,r;if(I(),D>=5)return void L();const l=(null===(e=a.current)||void 0===e?void 0:null===(t=e.video)||void 0===t?void 0:t.clientWidth)||500,c=(null===(n=a.current)||void 0===n?void 0:null===(r=n.video)||void 0===r?void 0:r.clientHeight)||400,o=Math.floor(Math.random()*(l-100))+50,s=Math.floor(Math.random()*(c-100))+50;b({x:o,y:s}),y(!0),$(null),x(!1),C(Date.now()),M&&(P.current=setTimeout(()=>{f&&q()},5e3))},q=()=>{var e,t;if(!f)return;const n=((null===(e=a.current)||void 0===e?void 0:null===(t=e.video)||void 0===t?void 0:t.clientWidth)||500)-80;$({x:n,y:E.y}),x(!0);let r=0;const l=Date.now();A.current=setInterval(()=>{const e=Date.now()-l;r=Math.min(1,e/1e3);const t=n+(E.x-n)*r;$({x:t,y:E.y}),r>=1&&(clearInterval(A.current),A.current=null,setTimeout(()=>{f&&(k(e=>[...e,5e3]),y(!1),j(e=>{const t=e+1;return F.current=t>=5?setTimeout(()=>{$(null),L([...N,5e3])},800):setTimeout(()=>{$(null),W()},1e3),t}))},500))},16)},L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;if(0===e.length)return void H();const t=Math.round(e.reduce((e,t)=>e+t,0)/e.length),a=Math.min(...e);let n;n=t<=300?90:t<=500?80:t<=750?70:t<=1e3?60:t<=2e3?50:t<=3e3?40:t<=4e3?30:20,n+=Math.floor(5*Math.random());let r="";r=(n=Math.min(95,n))>=70?"MediaPipe Hands \u5206\u6790\u986f\u793a\u60a8\u7684\u53cd\u61c9\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u624b\u90e8\u52d5\u4f5c\u5354\u8abf\u6027\u826f\u597d\u3002\u9019\u8868\u660e\u60a8\u7684\u904b\u52d5\u795e\u7d93\u529f\u80fd\u8655\u65bc\u5065\u5eb7\u72c0\u614b\uff0c\u6c92\u6709\u767c\u73fe\u8207\u65e9\u671f\u963f\u8332\u6d77\u9ed8\u75c7\u76f8\u95dc\u7684\u53cd\u61c9\u9072\u7de9\u73fe\u8c61\u3002":n>=50?"MediaPipe Hands \u5206\u6790\u986f\u793a\u60a8\u7684\u53cd\u61c9\u901f\u5ea6\u8655\u65bc\u6b63\u5e38\u7bc4\u570d\uff0c\u624b\u90e8\u52d5\u4f5c\u5354\u8abf\u6027\u57fa\u672c\u826f\u597d\u3002\u76ee\u524d\u6c92\u6709\u767c\u73fe\u660e\u986f\u7684\u7570\u5e38\u6a21\u5f0f\uff0c\u5efa\u8b70\u5b9a\u671f\u9032\u884c\u53cd\u61c9\u901f\u5ea6\u8a13\u7df4\u4ee5\u7dad\u6301\u826f\u597d\u72c0\u614b\u3002":"MediaPipe Hands \u5206\u6790\u986f\u793a\u60a8\u7684\u53cd\u61c9\u901f\u5ea6\u8f03\u6162\uff0c\u53ef\u80fd\u5b58\u5728\u8f15\u5fae\u7684\u624b\u90e8\u52d5\u4f5c\u5354\u8abf\u6027\u554f\u984c\u3002\u5efa\u8b70\u589e\u52a0\u53cd\u61c9\u8a13\u7df4\uff0c\u4e26\u8003\u616e\u9032\u884c\u66f4\u5168\u9762\u7684\u795e\u7d93\u529f\u80fd\u8a55\u4f30\u3002";const l=[...e];for(;l.length<5;)l.push(Math.round(t));S({score:n,averageTime:t,bestTime:a,times:l.slice(0,5),analysis:r}),h(!1)},H=()=>{I(),S(null),h(!1),k([]),j(0),y(!1),$(null),x(!1)};return O?r.a.createElement(p,{results:O,onReset:H}):r.a.createElement("div",{className:"test-container"},r.a.createElement("h2",null,"\u53cd\u61c9\u901f\u5ea6\u6e2c\u91cf (MediaPipe Hands\u6280\u8853)"),r.a.createElement("div",{className:"mode-toggles"},r.a.createElement("button",{onClick:()=>T(!R),className:"debug-button"},R?"\u96b1\u85cf\u8abf\u8a66\u4fe1\u606f":"\u986f\u793a\u8abf\u8a66\u4fe1\u606f"),r.a.createElement("button",{onClick:()=>{z(!M)},className:"demo-button"},M?"\u7981\u7528\u6f14\u793a\u6a21\u5f0f":"\u555f\u7528\u6f14\u793a\u6a21\u5f0f")),M&&r.a.createElement("div",{className:"demo-banner"},r.a.createElement("p",null,"\u6f14\u793a\u6a21\u5f0f\u5df2\u555f\u7528\uff1a\u6e2c\u8a66\u5c07\u5728 5 \u79d2\u7121\u53cd\u61c9\u5f8c\u81ea\u52d5\u5b8c\u6210")),o?r.a.createElement("div",{className:"loading-container"},r.a.createElement("p",null,"\u6b63\u5728\u52a0\u8f09 MediaPipe Hands \u6a21\u578b\uff0c\u8acb\u7a0d\u5019...")):u?d?r.a.createElement("div",{className:"test-active"},r.a.createElement("p",{className:"test-description"},"\u7576\u85cd\u8272\u5713\u5708\u51fa\u73fe\u6642\uff0c\u8acb\u8fc5\u901f\u5c07\u60a8\u7684\u624b\u79fb\u52d5\u5230\u5713\u5708\u4f4d\u7f6e\uff0c\u6216\u76f4\u63a5\u9ede\u64ca\u5713\u5708\u3002",M&&" \u6f14\u793a\u6a21\u5f0f\uff1a5 \u79d2\u5f8c\u5c07\u81ea\u52d5\u6a21\u64ec\u624b\u90e8\u79fb\u52d5"),r.a.createElement("div",{className:"video-container"},r.a.createElement(g.a,{ref:a,mirrored:!0,style:{width:"100%",height:"auto",borderRadius:"8px"},videoConstraints:{width:640,height:480,facingMode:"user"}}),U&&r.a.createElement("div",{className:"demo-hand",style:{left:`${U.x}px`,top:`${U.y}px`}},"\u270b"),f&&D<5&&r.a.createElement("div",{className:"hand-target",style:{left:`${E.x}px`,top:`${E.y}px`},onClick:()=>{if(!f)return;I();const e=Date.now()-w;k(t=>[...t,e]),y(!1),$(null),j(t=>{const a=t+1;return a>=5?L([...N,e]):F.current=setTimeout(W,1e3),a})}},"\ud83d\udc4b")),r.a.createElement("div",{className:"test-stats"},r.a.createElement("div",{className:"test-stat"},r.a.createElement("div",{className:"test-stat-label"},"\u6e2c\u8a66\u9032\u5ea6"),r.a.createElement("div",{className:"test-stat-value"},D,"/",5)),r.a.createElement("div",{className:"test-stat"},r.a.createElement("div",{className:"test-stat-label"},"\u624b\u90e8\u6aa2\u6e2c"),r.a.createElement("div",{className:`test-stat-value ${v?"detected":""}`},v?"\u2713":"\u2717")),r.a.createElement("div",{className:"test-stat"},r.a.createElement("div",{className:"test-stat-label"},"\u4e0a\u6b21\u53cd\u61c9"),r.a.createElement("div",{className:"test-stat-value"},N.length>0?`${N[N.length-1]}ms`:"-"))),R&&r.a.createElement("div",{className:"debug-log"},r.a.createElement("h4",null,"\u6e2c\u8a66\u904b\u884c\u65e5\u8a8c\uff1a"),r.a.createElement("ul",null,G.map((e,t)=>r.a.createElement("li",{key:t},e))))):r.a.createElement("div",{className:"test-intro"},r.a.createElement("p",{className:"test-description"},"\u6b64\u6e2c\u8a66\u4f7f\u7528 MediaPipe Hands \u6280\u8853\u6e2c\u91cf\u60a8\u7684\u53cd\u61c9\u901f\u5ea6\u548c\u624b\u90e8\u5354\u8abf\u6027\u3002 \u7576\u85cd\u8272\u5713\u5708\u51fa\u73fe\u6642\uff0c\u8acb\u8fc5\u901f\u5c07\u60a8\u7684\u624b\u79fb\u52d5\u5230\u5713\u5708\u4f4d\u7f6e\uff0c\u6216\u76f4\u63a5\u9ede\u64ca\u5713\u5708\u3002",M&&r.a.createElement("span",{className:"demo-note"}," \u6f14\u793a\u6a21\u5f0f\u5c07\u57285\u79d2\u5f8c\u81ea\u52d5\u6a21\u64ec\u624b\u90e8\u79fb\u52d5\u3002")),r.a.createElement("div",{className:"video-container"},r.a.createElement(g.a,{ref:a,mirrored:!0,style:{width:"100%",height:"auto",borderRadius:"8px"},videoConstraints:{width:640,height:480,facingMode:"user"}}),r.a.createElement("div",{className:"camera-overlay"},r.a.createElement("button",{className:"submit-button",onClick:()=>{I(),k([]),j(0),h(!0),y(!1),$(null),F.current=setTimeout(()=>{W()},2e3)}},"\u958b\u59cb\u6e2c\u8a66"))),r.a.createElement("div",{className:"tech-explanation"},r.a.createElement("h3",null,"MediaPipe Hands \u6280\u8853"),r.a.createElement("p",null,"\u6b64\u6e2c\u8a66\u4f7f\u7528 Google \u7684 MediaPipe Hands \u6280\u8853\uff0c\u53ef\u4ee5\u900f\u904e\u524d\u7f6e\u651d\u50cf\u982d\u6aa2\u6e2c21\u500b\u624b\u90e8\u95dc\u9375\u9ede\u3002 \u7cfb\u7d71\u901a\u904e\u8ffd\u8e2a\u624b\u90e8\u52d5\u4f5c\u4f86\u5206\u6790\u5354\u8abf\u6027\u548c\u53cd\u61c9\u6642\u9593 - \u9019\u4e9b\u53c3\u6578\u5728\u65e9\u671f\u963f\u8332\u6d77\u9ed8\u75c7\u60a3\u8005\u4e2d\u5e38\u6709\u8b8a\u5316\u3002"))):r.a.createElement("div",{className:"camera-permission"},r.a.createElement("p",null,"\u6b64\u6e2c\u8a66\u9700\u8981\u4f7f\u7528\u60a8\u7684\u651d\u50cf\u982d\u4f86\u8ffd\u8e2a\u624b\u90e8\u52d5\u4f5c\u3002"),r.a.createElement("p",null,"\u8acb\u5728\u700f\u89bd\u5668\u5f48\u51fa\u7684\u6b0a\u9650\u8acb\u6c42\u4e2d\u5141\u8a31\u4f7f\u7528\u651d\u50cf\u982d\u3002"),r.a.createElement("button",{className:"submit-button",onClick:()=>window.location.reload()},"\u91cd\u8a66")))};function E(e){let{results:t,onReset:a}=e;return r.a.createElement("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",textAlign:"center"}},r.a.createElement("h2",{style:{fontSize:"24px",marginBottom:"20px"}},"\u8996\u89ba\u53cd\u61c9\u6e2c\u8a66\u7d50\u679c"),r.a.createElement("div",{style:{display:"flex",justifyContent:"center",gap:"30px",margin:"30px 0"}},r.a.createElement("div",{style:{padding:"20px",backgroundColor:"#f0fdf4",borderRadius:"8px",minWidth:"120px"}},r.a.createElement("div",{style:{fontSize:"14px",color:"#666",marginBottom:"5px"}},"\u5206\u6578"),r.a.createElement("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#22c55e"}},t.score)),r.a.createElement("div",{style:{padding:"20px",backgroundColor:"#f0f9ff",borderRadius:"8px",minWidth:"120px"}},r.a.createElement("div",{style:{fontSize:"14px",color:"#666",marginBottom:"5px"}},"\u5e73\u5747\u53cd\u61c9\u6642\u9593"),r.a.createElement("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#0ea5e9"}},t.averageTime,"ms"))),r.a.createElement("div",{style:{padding:"20px",backgroundColor:"#f9fafb",borderRadius:"8px",marginBottom:"30px",textAlign:"left",lineHeight:1.6}},r.a.createElement("h3",{style:{fontSize:"18px",marginBottom:"10px"}},"\u5206\u6790\u7d50\u679c"),r.a.createElement("p",null,t.analysis)),r.a.createElement("button",{onClick:a,style:{backgroundColor:"#5D5CDE",color:"white",border:"none",padding:"12px 24px",fontSize:"16px",fontWeight:"bold",borderRadius:"8px",cursor:"pointer"}},"\u56de\u5230\u6e2c\u8a66\u9801\u9762"))}var b=function(e){let{setCurrentTest:t}=e;const a=Object(n.useRef)(null),l=Object(n.useRef)(null),c=Object(n.useRef)(null),o=Object(n.useRef)(null),s=Object(n.useRef)(null),i=Object(n.useRef)(null),u=Object(n.useRef)(!0),[m,d]=Object(n.useState)(!1),[p,h]=Object(n.useState)(null),[b,f]=Object(n.useState)({x:0,y:0}),[y,v]=Object(n.useState)(!1),[x,w]=Object(n.useState)([]),[C,N]=Object(n.useState)(0),[k,D]=Object(n.useState)(null),[j,O]=Object(n.useState)(null),[S,R]=Object(n.useState)(!1),[T,G]=Object(n.useState)(60),[B,M]=Object(n.useState)(!1),[z,U]=Object(n.useState)(0),[$,P]=Object(n.useState)(!1),[A,F]=Object(n.useState)("extreme"),[I,W]=Object(n.useState)(0),q={low:{focusThreshold:.08,motionThreshold:.15},medium:{focusThreshold:.05,motionThreshold:.12},high:{focusThreshold:.03,motionThreshold:.08},extreme:{focusThreshold:.015,motionThreshold:.04}};Object(n.useEffect)(()=>{let e=null,t=null;if($&&y&&S){const a=Date.now();console.log("Steady state detected, starting auto-advance timer"),t=setInterval(()=>{const e=Date.now()-a,n=Math.min(100,e/2e3*100);W(n),n>=100&&clearInterval(t)},50),e=setTimeout(()=>{console.log("Sustained stability detected - auto-advancing"),_("gaze")},2e3)}else W(0);return()=>{e&&clearTimeout(e),t&&clearInterval(t)}},[$,y,S]),Object(n.useEffect)(()=>{k?(console.log("Results are shown, stopping motion detection"),u.current=!1,i.current&&(cancelAnimationFrame(i.current),i.current=null)):u.current=!0},[k]);const L=()=>{if(!o.current)return;const e=()=>{if(!u.current)return void console.log("Motion detection stopped");if(!a.current||!a.current.video||4!==a.current.video.readyState)return void(i.current=requestAnimationFrame(e));const t=a.current.video,n=o.current,r=n.getContext("2d",{willReadFrequently:!0});320===n.width&&240===n.height||(n.width=320,n.height=240);try{r.drawImage(t,0,0,n.width,n.height);const e=r.getImageData(0,0,n.width,n.height);if(s.current){const t=s.current.data,a=e.data;let n=0,r=0;for(let e=0;e<a.length;e+=12){const l=Math.abs(a[e]-t[e]),c=Math.abs(a[e+1]-t[e+1]),o=Math.abs(a[e+2]-t[e+2]);r++,(l>10||c>10||o>10)&&n++}const l=n/r;U(l);const c=q[A];M(l>c.motionThreshold);const o=l<c.focusThreshold;P(o)}s.current=e}catch(l){console.error("Error in motion detection:",l)}u.current&&(i.current=requestAnimationFrame(e))};e()},H=()=>{console.log("Showing next target");const e=l.current;if(!e)return void console.error("Container ref not found");const t=e.getBoundingClientRect();console.log("Container dimensions:",t.width,t.height);const a=T,n=Math.floor(Math.random()*(t.width-2*a))+a,r=Math.floor(Math.random()*(t.height-2*a))+a;G(0===C?80:60),console.log(`Showing target ${C+1} at (${n}, ${r})`),f({x:n,y:r}),v(!0),O(Date.now()),W(0),console.log("Target should now be visible")},_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"click";if(!y)return;const t=Date.now()-j;console.log(`Target hit by ${e}! Reaction time: ${t}ms`);const a=[...x,t];w(a),v(!1),W(0),c.current&&clearTimeout(c.current);const n=C+1;N(n),console.log(`Test count: ${n} of 5`),n>=5?(console.log("All tests completed, stopping motion detection"),u.current=!1,i.current&&(cancelAnimationFrame(i.current),i.current=null),console.log("Finishing test"),setTimeout(()=>{V(a)},100)):c.current=setTimeout(H,1500)},V=e=>{const t=e||x;if(console.log("Finishing test with reaction times:",t),0===t.length)return void R(!1);const a=Math.round(t.reduce((e,t)=>e+t,0)/t.length),n=100-a/20,r=Math.max(50,Math.min(98,Math.round(n)));console.log(`Average time: ${a}ms, Score: ${r}`);let l="";const c={score:r,averageTime:a,accuracy:r,analysis:l=a<600&&r>90?"\u5206\u6790\u986f\u793a\u60a8\u7684\u8996\u89ba\u53cd\u61c9\u6642\u9593\u975e\u5e38\u5feb\uff0c\u8868\u660e\u60a8\u7684\u8996\u89ba\u8655\u7406\u80fd\u529b\u8655\u65bc\u512a\u7570\u6c34\u5e73\u3002\u9019\u4e9b\u7279\u5fb5\u901a\u5e38\u8868\u793a\u795e\u7d93\u7cfb\u7d71\u7684\u826f\u597d\u72c0\u614b\u3002":a<800&&r>80?"\u5206\u6790\u986f\u793a\u60a8\u7684\u8996\u89ba\u53cd\u61c9\u6642\u9593\u826f\u597d\u3002\u9019\u8868\u660e\u60a8\u7684\u8996\u89ba\u8655\u7406\u80fd\u529b\u8655\u65bc\u6b63\u5e38\u6c34\u5e73\u3002\u6c92\u6709\u767c\u73fe\u660e\u986f\u7684\u8a8d\u77e5\u969c\u7919\u8de1\u8c61\u3002":a<1e3&&r>70?"\u5206\u6790\u986f\u793a\u60a8\u7684\u8996\u89ba\u53cd\u61c9\u6642\u9593\u8655\u65bc\u6b63\u5e38\u7bc4\u570d\u3002\u60a8\u7684\u8996\u89ba\u8655\u7406\u80fd\u529b\u8868\u73fe\u4e00\u822c\uff0c\u5efa\u8b70\u5b9a\u671f\u9032\u884c\u8996\u89ba\u8a13\u7df4\u4ee5\u4fdd\u6301\u826f\u597d\u72c0\u614b\u3002":"\u5206\u6790\u986f\u793a\u60a8\u7684\u8996\u89ba\u53cd\u61c9\u6642\u9593\u8f03\u6162\u3002\u9019\u53ef\u80fd\u8868\u660e\u8996\u89ba\u8655\u7406\u65b9\u9762\u5b58\u5728\u4e00\u4e9b\u6311\u6230\u3002\u5efa\u8b70\u9032\u884c\u66f4\u5168\u9762\u7684\u8996\u89ba\u548c\u8a8d\u77e5\u8a55\u4f30\u3002"};console.log("Setting final results:",c),R(!1),D(c)};return Object(n.useEffect)(()=>()=>{u.current=!1,c.current&&clearTimeout(c.current),i.current&&cancelAnimationFrame(i.current)},[]),k?(console.log("Rendering results screen"),r.a.createElement(E,{results:k,onReset:()=>{D(null),u.current=!0,m&&o.current&&L()}})):r.a.createElement("div",{style:{padding:"20px",display:"flex",flexDirection:"column",gap:"20px",fontFamily:"system-ui, -apple-system, sans-serif",maxWidth:"800px",margin:"0 auto"}},r.a.createElement("div",{style:{borderBottom:"1px solid #e5e7eb",paddingBottom:"10px",marginBottom:"20px"}},r.a.createElement("h1",{style:{fontSize:"24px",margin:0}},"\u8996\u89ba\u53cd\u61c9\u6e2c\u8a66")),r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginBottom:"15px",backgroundColor:"#f8f9fa",padding:"10px",borderRadius:"8px",fontSize:"14px"}},r.a.createElement("div",{style:{padding:"5px 10px",borderRadius:"4px",backgroundColor:m?"#d1fae5":"#fee2e2"}},r.a.createElement("span",null,"\u76f8\u6a5f\uff1a"),r.a.createElement("strong",null,m?"\u2713":"\u2717")),r.a.createElement("div",{style:{padding:"5px 10px",borderRadius:"4px",backgroundColor:B?"#fee2e2":$?"#d1fae5":"#fef3c7"}},r.a.createElement("span",null,"\u7a69\u5b9a\u72c0\u614b\uff1a"),r.a.createElement("strong",null,B?"\u79fb\u52d5\u4e2d":$?"\u7a69\u5b9a":"\u9700\u8981\u7a69\u5b9a")),r.a.createElement("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"8px"}},r.a.createElement("span",null,"\u79fb\u52d5\u7a0b\u5ea6\uff1a"),r.a.createElement("div",{style:{width:"100px",height:"10px",backgroundColor:"#e5e7eb",borderRadius:"5px",overflow:"hidden"}},r.a.createElement("div",{style:{width:`${Math.min(100,100*z*5)}%`,height:"100%",backgroundColor:z>q[A].motionThreshold?"#ef4444":z<q[A].focusThreshold?"#22c55e":"#f59e0b",transition:"width 0.2s, background-color 0.2s"}})))),!S&&r.a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"8px",fontSize:"14px"}},r.a.createElement("span",null,"\u7a69\u5b9a\u9748\u654f\u5ea6\uff1a"),r.a.createElement("div",{style:{display:"flex",gap:"5px"}},["low","medium","high","extreme"].map(e=>r.a.createElement("button",{key:e,onClick:()=>(e=>{F(e)})(e),style:{padding:"5px 10px",backgroundColor:A===e?"#5D5CDE":"#f8f9fa",color:A===e?"white":"black",border:"1px solid #d1d5db",borderRadius:"4px",cursor:"pointer",fontWeight:A===e?"bold":"normal"}},"low"===e?"\u4f4e\u9748\u654f\u5ea6":"medium"===e?"\u4e2d\u7b49\u9748\u654f\u5ea6":"high"===e?"\u9ad8\u9748\u654f\u5ea6":"\u6975\u9ad8\u9748\u654f\u5ea6"))),r.a.createElement("div",{style:{marginLeft:"auto",fontSize:"13px",color:"#666"}},"low"===A?"\u9700\u8981\u975e\u5e38\u7a69\u5b9a":"medium"===A?"\u4e00\u822c\u7a69\u5b9a\u5ea6":"high"===A?"\u5141\u8a31\u8f15\u5fae\u79fb\u52d5":"\u5c0d\u8f15\u5fae\u79fb\u52d5\u6975\u5ea6\u654f\u611f")),S&&r.a.createElement("div",{style:{backgroundColor:"#f0f9ff",borderRadius:"8px",padding:"10px",textAlign:"center",fontSize:"16px",fontWeight:"bold"}},"\u6e2c\u8a66\u9032\u5ea6\uff1a",C," / ",5),p&&r.a.createElement("div",{style:{padding:"10px",backgroundColor:"#fee2e2",color:"#b91c1c",borderRadius:"8px",marginBottom:"15px"}},r.a.createElement("strong",null,"\u932f\u8aa4\uff1a")," ",p),r.a.createElement("div",null,r.a.createElement("div",{ref:l,style:{position:"relative",border:"1px solid #e5e7eb",borderRadius:"8px",overflow:"hidden",background:"#f8f9fa",minHeight:"300px"}},r.a.createElement(g.a,{ref:a,style:{width:"100%",maxHeight:"60vh",objectFit:"contain"},videoConstraints:{width:640,height:480,facingMode:"user"},audio:!1,onUserMedia:()=>{console.log("Camera is ready"),d(!0),o.current&&o.current.getContext("2d",{willReadFrequently:!0})&&L()},onUserMediaError:e=>{console.error("Camera error:",e),h(`\u76f8\u6a5f\u932f\u8aa4: ${e.name}`)}}),r.a.createElement("canvas",{ref:o,style:{position:"absolute",top:"-9999px",left:"-9999px",width:"320px",height:"240px"},width:"320",height:"240"}),y&&S&&r.a.createElement("div",{onClick:()=>_("click"),style:{position:"absolute",left:`${b.x}px`,top:`${b.y}px`,width:`${T}px`,height:`${T}px`,borderRadius:"50%",backgroundColor:"rgba(255, 0, 0, 0.8)",transform:"translate(-50%, -50%)",boxShadow:0===C?"0 0 30px rgba(255, 0, 0, 0.9)":"0 0 20px rgba(255, 0, 0, 0.8)",cursor:"pointer",animation:"pulse 0.7s infinite",zIndex:10}}),y&&$&&S&&r.a.createElement("div",{style:{position:"absolute",bottom:"50px",left:"10px",backgroundColor:"rgba(0, 0, 0, 0.7)",padding:"8px",borderRadius:"4px",color:"white",zIndex:20}},r.a.createElement("div",null,"\u7a69\u5b9a\u4e2d...\u81ea\u52d5\u9032\u884c"),r.a.createElement("div",{style:{width:"100px",height:"5px",backgroundColor:"#e5e7eb",borderRadius:"5px",marginTop:"5px"}},r.a.createElement("div",{style:{width:`${I}%`,height:"100%",backgroundColor:"#10b981",borderRadius:"5px",transition:"width 0.05s linear"}}))),r.a.createElement("div",{style:{position:"absolute",bottom:"10px",right:"10px",background:"rgba(0,0,0,0.6)",color:"white",padding:"5px 10px",borderRadius:"4px",fontSize:"14px"}},m?y?$?"\u4fdd\u6301\u7a69\u5b9a\uff0c\u81ea\u52d5\u9032\u884c":"\u4fdd\u6301\u7a69\u5b9a\u6216\u9ede\u64ca\u7d05\u8272\u76ee\u6a19":"\u6e96\u5099\u6e2c\u8a66":"\u23f3 \u7b49\u5f85\u76f8\u6a5f...")),S&&r.a.createElement("div",{style:{display:"flex",justifyContent:"center",gap:"30px",margin:"20px 0",padding:"15px",borderRadius:"8px",backgroundColor:"#f8f9fa"}},r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("div",{style:{fontSize:"14px",color:"#666"}},"\u6e2c\u8a66\u9032\u5ea6"),r.a.createElement("div",{style:{fontSize:"18px",fontWeight:"bold"}},C,"/",5)),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("div",{style:{fontSize:"14px",color:"#666"}},"\u7a69\u5b9a\u72c0\u614b"),r.a.createElement("div",{style:{fontSize:"18px",fontWeight:"bold",color:$?"#22c55e":"#f59e0b"}},$?"\u7a69\u5b9a":"\u4e0d\u7a69\u5b9a")),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("div",{style:{fontSize:"14px",color:"#666"}},"\u4e0a\u6b21\u53cd\u61c9"),r.a.createElement("div",{style:{fontSize:"18px",fontWeight:"bold"}},x.length>0?`${x[x.length-1]}ms`:"-"))),!S&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px"}},r.a.createElement("button",{onClick:()=>{console.log("Starting visual reaction test"),R(!0),N(0),w([]),D(null),u.current=!0,c.current=setTimeout(()=>{H()},2e3)},disabled:!m,style:{backgroundColor:"#5D5CDE",color:"white",border:"none",padding:"15px 30px",fontSize:"18px",fontWeight:"bold",borderRadius:"8px",cursor:m?"pointer":"not-allowed",opacity:m?1:.6,boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",transition:"all 0.2s"}},m?"\u958b\u59cb\u6e2c\u8a66":"\u7b49\u5f85\u76f8\u6a5f...")),r.a.createElement("div",{style:{textAlign:"center",marginTop:"20px"}},r.a.createElement("h3",{style:{fontSize:"18px"}},"\u6e2c\u8a66\u8aaa\u660e"),r.a.createElement("p",{style:{fontSize:"16px",lineHeight:1.6}},"\u6b64\u6e2c\u8a66\u8a55\u4f30\u60a8\u7684\u8996\u89ba\u53cd\u61c9\u80fd\u529b\u3002\u7576\u7d05\u8272\u76ee\u6a19\u51fa\u73fe\u6642\uff0c\u53ea\u9700\u770b\u8457\u5b83\u4e26\u4fdd\u6301\u7a69\u5b9a\u3002 \u7cfb\u7d71\u6703\u81ea\u52d5\u6aa2\u6e2c\u60a8\u7684\u7a69\u5b9a\u7a0b\u5ea6\uff0c\u7576\u60a8\u6210\u529f\u7a69\u5b9a\u6ce8\u8996\u76ee\u6a19\u6642\uff0c\u5c07\u81ea\u52d5\u9032\u5165\u4e0b\u4e00\u968e\u6bb5\u3002"),r.a.createElement("p",{style:{fontSize:"14px",color:"#666"}},"\u4e0a\u65b9\u986f\u793a\u5668\u6703\u76e3\u6e2c\u60a8\u7684\u7a69\u5b9a\u7a0b\u5ea6\uff0c\u5728\u7a69\u5b9a\u72c0\u614b\u4e0b\uff0c\u7cfb\u7d71\u5c07\u81ea\u52d5\u9032\u884c\u6e2c\u8a66\u3002\u60a8\u4e5f\u53ef\u4ee5\u9ede\u64ca\u7d05\u8272\u76ee\u6a19\u4f5c\u70ba\u5099\u9078\u65b9\u6cd5\u3002")))),r.a.createElement("style",{jsx:"true"},"\n        @keyframes pulse {\n          0% { transform: translate(-50%, -50%) scale(1); }\n          50% { transform: translate(-50%, -50%) scale(1.2); }\n          100% { transform: translate(-50%, -50%) scale(1); }\n        }\n      "))};a(329);class f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;this.R=e,this.Q=t,this.p=1,this.k=1,this.x=null}update(e){return null===this.x?(this.x=e,this.x):(this.p+=this.Q,this.k=this.p/(this.p+this.R),this.x+=this.k*(e-this.x),this.p*=1-this.k,this.x)}}const y=[{x:.1,y:.1},{x:.5,y:.1},{x:.9,y:.1},{x:.1,y:.5},{x:.5,y:.5},{x:.9,y:.5},{x:.1,y:.9},{x:.5,y:.9},{x:.9,y:.9}],v=2,x=500,w=3e4;function C(e){let{setCurrentTest:t}=e;const[a,l]=Object(n.useState)(null),[c,o]=Object(n.useState)("Initializing..."),[s,i]=Object(n.useState)("info"),[u,m]=Object(n.useState)(!1),[d,g]=Object(n.useState)(!1),[p,h]=Object(n.useState)(!1),[E,b]=Object(n.useState)(!1),[C,N]=Object(n.useState)({isCalibrating:!1,currentPointIndex:0,clicksMade:0,completedPoints:0}),[k,D]=Object(n.useState)({x:null,y:null}),[j,O]=Object(n.useState)(!0),[S,R]=Object(n.useState)(w/1e3),[T,G]=Object(n.useState)({x:10,y:10}),[B,M]=Object(n.useState)(null),z=Object(n.useRef)(!0),U=Object(n.useRef)(new f),$=Object(n.useRef)(new f),P=Object(n.useRef)(0),A=Object(n.useRef)(null),F=Object(n.useRef)(null),I=Object(n.useRef)(null),W=Object(n.useRef)(null),q=Object(n.useRef)(null),L=Object(n.useRef)({x:null,y:null}),H=Object(n.useRef)(T),_=Object(n.useRef)(null),V=Object(n.useRef)([]),Y=Object(n.useRef)(null),J=Object(n.useRef)(a),Q=Object(n.useRef)(!1),K=Object(n.useRef)({x:null,y:null});Object(n.useEffect)(()=>{L.current=k},[k]),Object(n.useEffect)(()=>{H.current=T},[T]),Object(n.useEffect)(()=>{J.current=a,console.log("[DEBUG] modeRef updated to:",a)},[a]);const X=Object(n.useCallback)(e=>{console.log(`[DEBUG] setMode called with: ${e}`),l(e)},[]),Z=Object(n.useCallback)((e,t,a)=>{if(console.log("[DEBUG] calculateAccuracy called, gazeCoords:",e,"targetCoordsPct:",t),!a)return console.log("[DEBUG] calculateAccuracy: container is null"),5;const n=a.getBoundingClientRect();if(console.log("[DEBUG] calculateAccuracy: rect:",n),0===n.width||0===n.height)return console.log("[DEBUG] calculateAccuracy: rect has zero dimensions"),5;const r="number"!==typeof e.x||isNaN(e.x)?null!==K.current.x?K.current.x:50:e.x/n.width*100,l="number"!==typeof e.y||isNaN(e.y)?null!==K.current.y?K.current.y:50:e.y/n.height*100;console.log("[DEBUG] calculateAccuracy: using gazeCoords (pct):",{x:r,y:l});const c=Math.hypot(r-t.x,l-t.y),o=Math.hypot(100,100),s=Math.max(5,Math.min(100,100-c/o*100));return console.log("[DEBUG] calculateAccuracy: dist:",c,"maxDist:",o,"accuracy:",s),"number"!==typeof e.x||isNaN(e.x)||(K.current.x=r,K.current.y=l),s},[]),ee=Object(n.useCallback)(e=>{if(console.log("[DEBUG] calculateConsistency: samples:",e),!Array.isArray(e)||e.length<2)return console.log("[DEBUG] calculateConsistency: insufficient samples"),"5.0";const t=e.filter(e=>"number"===typeof e&&!isNaN(e)&&e>0);if(console.log("[DEBUG] calculateConsistency: validSamples:",t),t.length<2)return console.log("[DEBUG] calculateConsistency: insufficient valid samples"),"5.0";const a=t.reduce((e,t)=>e+t,0)/t.length;if(console.log("[DEBUG] calculateConsistency: mean:",a),0===a)return console.log("[DEBUG] calculateConsistency: mean is zero"),"5.0";const n=t.reduce((e,t)=>e+(t-a)**2,0)/t.length,r=100-Math.sqrt(n)/a*100,l=Math.max(5,Math.min(100,r)).toFixed(1);return console.log("[DEBUG] calculateConsistency: consistency:",l),l},[]),te=Object(n.useCallback)(()=>{G(e=>{let{x:t,y:a}=e;return t<90&&10===a?t+=.5:t>=90&&a<90?a+=.5:t>10&&a>=90?t-=.5:t<=10&&a>10&&(a-=.5),{x:t=Math.max(10,Math.min(90,t)),y:a=Math.max(10,Math.min(90,a))}})},[]),ae=Object(n.useCallback)(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("MediaDevices API not supported."),z.current&&o("Camera features not supported by your browser."),!1;try{return(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),console.log("[DEBUG] Camera permission granted and stream stopped."),!0}catch(e){return console.error("[DEBUG] Camera permission denied:",e),!1}},[]),ne=Object(n.useRef)((e,t)=>{console.log("[DEBUG] stableGazeCallback called, gazeData:",e),Y.current&&Y.current(e)}).current,re=Object(n.useCallback)(e=>{if(console.log("[DEBUG] updateGazeDataProcessing: gazeData:",e),!z.current||!F.current)return void console.log("[DEBUG] updateGazeDataProcessing: component unmounted or trackingAreaRef missing");const t=F.current.getBoundingClientRect();if(console.log("[DEBUG] updateGazeDataProcessing: trackingArea rect:",t),!e||"number"!==typeof e.x||isNaN(e.x)||"number"!==typeof e.y||isNaN(e.y))return console.log("[DEBUG] updateGazeDataProcessing: invalid gazeData, using last valid or default"),void D(K.current&&null!==K.current.x?{x:K.current.x/100*t.width,y:K.current.y/100*t.height}:{x:.5*t.width,y:.5*t.height});const a=U.current.update(e.x),n=$.current.update(e.y);console.log("[DEBUG] updateGazeDataProcessing: filteredX:",a,"filteredY:",n);const r=Date.now();r-P.current>16&&(D({x:a-t.left,y:n-t.top}),P.current=r,K.current={x:(a-t.left)/t.width*100,y:(n-t.top)/t.height*100})},[D]);Object(n.useEffect)(()=>{Y.current=re},[re]);const le=Object(n.useCallback)(()=>{console.log("[DEBUG] Stopping all intervals."),I.current&&(clearInterval(I.current),I.current=null),W.current&&(clearInterval(W.current),W.current=null),q.current&&(clearInterval(q.current),q.current=null)},[]),ce=Object(n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown";if(console.log(`[DEBUG] stopWebGazer called from: ${e}. Current isCameraActive: ${d}`),le(),A.current&&d){const e=A.current;z.current&&(o("Stopping eye tracking..."),i("info")),console.log("[DEBUG] WebGazer instance exists and camera is active. Proceeding to stop.");try{"function"===typeof e.removeGazeListener&&(e.removeGazeListener(ne),console.log("[DEBUG] Gaze listener removed.")),"function"===typeof e.isReady&&e.isReady()&&(await e.pause(),console.log("[DEBUG] WebGazer paused.")),await e.end(),console.log("[DEBUG] WebGazer ended successfully.")}catch(t){console.error("[DEBUG] Error during WebGazer stop/end:",t),z.current&&(o(`Error stopping eye tracking: ${t.message}`),i("error"))}finally{z.current&&(g(!1),console.log("[DEBUG] isCameraActive set to false."))}}else console.log(`[DEBUG] stopWebGazer: WebGazer not running (isCameraActive: ${d}) or instance not available.`),z.current&&d&&(g(!1),console.log("[DEBUG] isCameraActive was true but instance check failed, forcing to false."))},[d,le,ne]),oe=Object(n.useCallback)(async()=>{if(!A.current||!u)return z.current&&(o("WebGazer module not ready."),i("error")),!1;if(d)return console.warn("[DEBUG] startGazing called but camera already active."),!0;z.current&&(o("Starting camera & eye tracking model... (this may take a moment)"),i("info"));try{const t=A.current;return t.params.showVideoPreview=!1,t.params.showVideo=!1,t.params.showFaceOverlay=!1,t.params.showPredictionPoints=!1,console.log("[DEBUG] startGazing: Setting gaze listener"),t.setGazeListener(ne),console.log("[DEBUG] startGazing: Gaze listener set successfully"),await t.begin(),console.log("[DEBUG] WebGazer.begin() successful."),t.showVideo(!1),t.showFaceOverlay(!1),t.showPredictionPoints(!1),z.current&&(g(!0),console.log("[DEBUG] isCameraActive set to true.")),!0}catch(e){return console.error("[DEBUG] Error starting eye tracking (wg.begin):",e),z.current&&(o(`Error starting eye tracking: ${e.message}`),i("error"),g(!1),h(!0)),!1}},[u,d,ne]),se=Object(n.useCallback)(async()=>{if(console.log("[DEBUG] prepareWebGazer called."),await ae()){z.current&&(o("Camera permission granted. Loading eye tracking module..."),i("info"),h(!1));try{let t=0;for(;!window.webgazer&&t++<50;)await new Promise(e=>setTimeout(e,100));if(!window.webgazer)throw new Error("WebGazer.js script failed to load/initialize.");A.current=window.webgazer;const a=A.current;a.params.showVideoPreview=!1,a.params.showPredictionPoints=!1,a.params.showFaceOverlay=!1,a.params.showVideo=!1,a.params.smoothing=!0,z.current&&(m(!0),o("System ready. Please calibrate before testing."),i("success"),console.log("[DEBUG] WebGazer prepared successfully."))}catch(e){console.error("[DEBUG] Error preparing WebGazer:",e),z.current&&(o(`Error preparing WebGazer: ${e.message}`),i("error"),h(!0),m(!1))}}else z.current&&(o("Error: Camera access denied. Please grant permission and retry."),i("error"),h(!0),m(!1))},[ae]);Object(n.useEffect)(()=>{z.current=!0,console.log("[DEBUG] RealEyeTracking component mounted."),o("Initializing system...");const e=setTimeout(()=>{if(!z.current)return;const e=()=>{z.current&&setTimeout(()=>{z.current&&se()},100)};if(window.webgazer)e();else{z.current&&o("Loading WebGazer.js script...");const t=document.createElement("script");t.src="https://webgazer.cs.brown.edu/webgazer.js",t.async=!0,document.head.appendChild(t),t.onload=e,t.onerror=(()=>{z.current&&(o("Critical Error: Failed to load WebGazer.js. Please refresh."),i("error"),h(!0),m(!1))})}},100);return()=>{z.current=!1,clearTimeout(e),console.log("[DEBUG] RealEyeTracking component unmounting. Cleaning up..."),le();const t=A.current;if(t){if(console.log("[DEBUG] Unmount: WebGazer instance exists. Attempting to stop."),"function"===typeof t.removeGazeListener)try{t.removeGazeListener(ne),console.log("[DEBUG] Unmount: Gaze listener removed.")}catch(a){console.warn("[DEBUG] Unmount: Minor error removing gaze listener:",a)}"function"===typeof t.end&&t.end().then(()=>console.log("[DEBUG] Unmount: WebGazer.end() called.")).catch(e=>console.error("[DEBUG] Unmount: Error calling WebGazer.end():",e)),A.current=null}}},[se,le,ne]);const ie=Object(n.useCallback)(async()=>{if(!C.isCalibrating||!u||!d||!j)return;O(!1),setTimeout(()=>{z.current&&O(!0)},x);let{clicksMade:e,currentPointIndex:t,completedPoints:a}=C;e++;const n=y[t];console.log("[DEBUG] handleCalibrationClick: Click recorded, point:",n,"clicksMade:",e);let r={...C,clicksMade:e};if(e>=v){a++;const e=t+1;e<y.length?(r={isCalibrating:!0,currentPointIndex:e,clicksMade:0,completedPoints:a},z.current&&o(`Point ${e+1}/${y.length} - Click ${v} times`)):(r={isCalibrating:!1,currentPointIndex:0,clicksMade:0,completedPoints:a},z.current&&(o("Calibration complete! Processing..."),await ce("calibration_complete"),z.current&&(b(!0),X(null),o("Calibration complete! Ready to test."),i("success"),console.log("[DEBUG] handleCalibrationClick: Calibration completed, isCalibrated set to true."))))}else z.current&&o(`Point ${t+1}/${y.length} - ${v-e} clicks left`);z.current&&N(r)},[C,u,d,j,ce,X]),ue=Object(n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";if(console.log(`[DEBUG] endTest called. Early: ${e}, Reason: ${t}, Mode: ${a}, modeRef: ${J.current}`),!z.current)return console.log("[DEBUG] endTest call skipped: component not mounted."),void le();try{if(le(),await ce(e?"test_early_exit":"test_natural_end"),!z.current)return void console.log("[DEBUG] Component unmounted during endTest after stopWebGazer.");console.log("[DEBUG] endTest: accuracyRef.current:",V.current);const t=V.current.filter(e=>"number"===typeof e&&!isNaN(e)&&e>0);console.log("[DEBUG] endTest: validSamples:",t);const a=t.length?t.reduce((e,t)=>e+t,0)/t.length:5,r=_.current?((Date.now()-_.current)/1e3).toFixed(1):"0.0";M({accuracy:a.toFixed(1),consistency:ee(t),duration:r,samples:V.current.length}),X("results"),o(e?"Test ended early. View results.":"Test complete. View your results."),i("success"),R(0),Q.current=!0,console.log("[DEBUG] Test ended, results set, mode changed to results.")}catch(n){console.error("[DEBUG] Error in endTest:",n),z.current&&(o(`Error ending test: ${n.message}`),i("error"),X("results"))}},[a,ce,ee,le,X]),me=C.isCalibrating?(C.completedPoints*v+C.clicksMade)/(y.length*v)*100:0,de=!u||d;return console.log("[DEBUG] Render, mode:",a),r.a.createElement("div",{className:"eye-test-container"},r.a.createElement("div",{className:"header-section"},r.a.createElement("h2",null,"Eye Tracking Test"),r.a.createElement("div",{className:`status ${s}`},c)),r.a.createElement("div",{className:"main-content"},!p||d||u?"results"===a?r.a.createElement("div",{className:"results-panel"},r.a.createElement("h3",null,"Test Results"),r.a.createElement("div",{className:"result-item"},r.a.createElement("span",{className:"result-label"},"Accuracy:"),r.a.createElement("span",{className:"result-value"},null===B||void 0===B?void 0:B.accuracy,"%"),r.a.createElement("span",{className:"result-description"},"(Closeness to target)")),r.a.createElement("div",{className:"result-item"},r.a.createElement("span",{className:"result-label"},"Consistency:"),r.a.createElement("span",{className:"result-value"},null===B||void 0===B?void 0:B.consistency,"%"),r.a.createElement("span",{className:"result-description"},"(Steadiness)")),r.a.createElement("div",{className:"result-item"},r.a.createElement("span",{className:"result-label"},"Duration:"),r.a.createElement("span",{className:"result-value"},null===B||void 0===B?void 0:B.duration,"s")),r.a.createElement("div",{className:"result-item"},r.a.createElement("span",{className:"result-label"},"Samples:"),r.a.createElement("span",{className:"result-value"},null===B||void 0===B?void 0:B.samples)),r.a.createElement("button",{type:"button",onClick:async()=>{console.log("[DEBUG] handleBackToMenu called."),await ce("back_to_menu"),z.current&&(X(null),M(null),R(w/1e3),D({x:null,y:null}),o("System ready. Please calibrate before testing."),i("info"),Q.current=!1)},className:"control-button"},"Back to Menu")):"calibration"===a?r.a.createElement("div",{className:"calibration-view"},r.a.createElement("div",{className:"tracking-area",onClick:ie,ref:F},C.isCalibrating&&r.a.createElement("div",{className:"calibration-point",style:(()=>{if(!C.isCalibrating||!y[C.currentPointIndex])return{display:"none"};const e=y[C.currentPointIndex];return{left:`${100*e.x}%`,top:`${100*e.y}%`,opacity:Math.min(1,.2*C.clicksMade+.2),backgroundColor:C.clicksMade>=v?"yellow":"red"}})()})),r.a.createElement("div",{className:"calibration-progress"},r.a.createElement("progress",{value:me,max:"100"}),r.a.createElement("span",null,Math.round(me),"% complete")),r.a.createElement("div",{className:"button-row"},r.a.createElement("button",{onClick:async()=>{console.log("[DEBUG] endCalibration (early exit) called."),await ce("calibration_early_exit"),z.current&&(N({isCalibrating:!1,currentPointIndex:0,clicksMade:0,completedPoints:0}),b(!1),X(null),o("Calibration canceled. Please calibrate before testing."),i("info"),console.log("[DEBUG] endCalibration: Calibration canceled, isCalibrated set to false."))},className:"exit-button"},"Exit Calibration")),r.a.createElement("div",{className:"calibration-instructions"},r.a.createElement("p",null,"Click each red point until it turns yellow (",v," clicks per point). Remain still."))):"test"===a?r.a.createElement("div",{className:"test-view"},r.a.createElement("div",{className:"tracking-area",ref:F},r.a.createElement("div",{className:"target-dot",style:{left:`${T.x}%`,top:`${T.y}%`}}),d&&"number"===typeof k.x&&!isNaN(k.x)&&r.a.createElement("div",{className:"gaze-indicator",style:{left:`${k.x}px`,top:`${k.y}px`}})),r.a.createElement("div",{className:"button-row"},r.a.createElement("button",{onClick:()=>ue(!0,"early_exit_button"),className:"exit-button"},"End Test Early"))):r.a.createElement("div",{className:"mode-selection"},r.a.createElement("div",{className:"mode-card"},r.a.createElement("h3",null,"Calibration"),r.a.createElement("p",{className:"mode-description"},"Calibrate for accuracy (",v," clicks per point)."),r.a.createElement("button",{onClick:async()=>{if(console.log("[DEBUG] startCalibrationMode called."),!u)return o("System not ready. Please grant permissions or wait."),void i("error");if(d)return o("Another process is active."),void i("error");if(A.current){console.log("[DEBUG] startCalibrationMode: Resetting WebGazer model");try{await A.current.clearData(),console.log("[DEBUG] startCalibrationMode: WebGazer data cleared")}catch(e){console.warn("[DEBUG] startCalibrationMode: Error clearing WebGazer data:",e)}}await oe()&&z.current&&(X("calibration"),N({isCalibrating:!0,currentPointIndex:0,clicksMade:0,completedPoints:0}),o(`Point 1/${y.length} - Click ${v} times`),i("info"),console.log("[DEBUG] startCalibrationMode: Calibration started."))},disabled:de,className:`mode-button ${de?"disabled":""}`},"Start Calibration")),r.a.createElement("div",{className:"mode-card"},r.a.createElement("h3",null,"Eye Test"),r.a.createElement("p",{className:"mode-description"},"Follow target for ",w/1e3,"s."),r.a.createElement("button",{onClick:async()=>{if(console.log("[DEBUG] startTestMode called, isCalibrated:",E),!u)return o("System not ready."),void i("error");if(d)return o("Another process is active."),void i("error");if(!E)return o("Please complete calibration before testing."),void i("error");await oe()&&z.current&&(_.current=Date.now(),Q.current=!1,console.log("[DEBUG] Setting mode to 'test'"),X("test"),M(null),R(w/1e3),G({x:10,y:10}),V.current=[],K.current={x:null,y:null},o(`Follow the blue dot - ${w/1e3}s left`),i("info"),I.current=setInterval(te,30),setTimeout(()=>{z.current&&(console.log("[DEBUG] Starting countdownInterval, modeRef:",J.current),W.current=setInterval(()=>{if(!z.current||Q.current)return console.log("[DEBUG] Component unmounted or test ended, clearing countdownInterval."),void(W.current&&(clearInterval(W.current),W.current=null));R(e=>{const t=e-1;return console.log(`[DEBUG] Countdown tick, timeLeft: ${t}, modeRef: ${J.current}`),t>=0&&o(`Follow the blue dot - ${t}s left`),t<=0&&!Q.current?(console.log("[DEBUG] timeLeft <= 0, ending test. modeRef:",J.current),W.current&&(clearInterval(W.current),W.current=null),le(),console.log("[DEBUG] Countdown finished, ending test naturally."),ue(!1,"countdown_finished"),e):t})},1e3))},500),q.current=setInterval(()=>{if(console.log("[DEBUG] accuracyInterval tick, isCameraActive:",d,"trackingAreaRef.current:",!!F.current),z.current&&d&&F.current){const e=L.current;console.log("[DEBUG] accuracyInterval: gazeRelativeToTrackingArea:",e);const t=Z(e,H.current,F.current);console.log("[DEBUG] accuracyInterval: calculated accuracy:",t),V.current.push(t)}else console.log("[DEBUG] accuracyInterval: conditions not met (isCameraActive:",d,", trackingAreaRef.current:",!!F.current,")"),V.current.push(5)},500))},disabled:de||!E,className:`mode-button ${de||!E?"disabled":""}`},"Start Test"))):r.a.createElement("div",{className:"error-panel"},r.a.createElement("p",null,"A camera or system initialization error occurred."),r.a.createElement("button",{onClick:async()=>{console.log("[DEBUG] retryCameraAccess called."),z.current&&(o("Retrying camera permission and setup..."),i("info"),h(!1),m(!1),g(!1),b(!1),await se())},className:"retry-button"},"Retry Camera Access"),r.a.createElement("div",{className:"troubleshooting"},r.a.createElement("p",null,"Tips:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Ensure browser has camera permissions for this site."),r.a.createElement("li",null,"Check if another app is using the camera."),r.a.createElement("li",null,"Good lighting is important."))))),r.a.createElement("div",{className:"footer-section"},r.a.createElement("button",{onClick:async()=>{console.log("[DEBUG] handleReturnHome called.");try{await ce("return_to_home"),z.current&&(t("home"),X(null),b(!1),Q.current=!1,o("System ready. Please calibrate before testing."),i("info"))}catch(e){console.error("[DEBUG] Error in handleReturnHome:",e),z.current&&(o("Error returning home. Please try again."),i("error"))}},className:"home-button"},"Return to Home")))}var N=a(298);a(330);function k(e){let{setCurrentTest:t}=e;const a=7e3,l=[1.5,2,2.5],c=[1e3,2e3,1500],[o,s]=Object(n.useState)("intro"),[i,u]=Object(n.useState)(0),[m,d]=Object(n.useState)({type:null,isTransitioning:!1}),[g,p]=Object(n.useState)([]),[h,E]=Object(n.useState)(""),[b,f]=Object(n.useState)(null),[y,v]=Object(n.useState)(null),[x,w]=Object(n.useState)(!1),[C,k]=Object(n.useState)(null),[D,j]=Object(n.useState)(null),[O,S]=Object(n.useState)(null),R=Object(n.useRef)(null),T=Object(n.useRef)(null),G=Object(n.useRef)(document.createElement("canvas")),B=Object(n.useRef)(null),M=Object(n.useRef)(Math.floor(100+900*Math.random())),z=Object(n.useRef)(null),U=Object(n.useRef)(null),$=Object(n.useRef)(null),P=Object(n.useRef)(null),A=e=>new Promise(t=>setTimeout(t,e));async function F(){var e;if((null===(e=R.current)||void 0===e?void 0:e.readyState)>=HTMLMediaElement.HAVE_METADATA){var t;const e=G.current,a=e.getContext("2d");a.filter="brightness(0.8) contrast(300%) grayscale(100%)",a.drawImage(R.current,0,0,e.width,e.height),await(null===(t=T.current)||void 0===t?void 0:t.send({image:e}))}requestAnimationFrame(F)}function I(){if(console.log("Cleaning up camera and FaceMesh"),$.current){$.current.getTracks().forEach(e=>e.stop()),$.current=null}R.current&&(R.current.srcObject=null),T.current&&"function"===typeof T.current.close&&(T.current.close(),T.current=null),U.current&&(clearTimeout(U.current),U.current=null),P.current&&(clearTimeout(P.current),P.current=null),w(!1)}function W(e){let{multiFaceLandmarks:t}=e;if(!(null===t||void 0===t?void 0:t.length))return B.current=null,v(null),void(U.current||"testing"!==o||(U.current=setTimeout(()=>{S("Face not detected. Please face the camera directly and ensure good lighting.")},2e3)));U.current&&(clearTimeout(U.current),U.current=null,S(null));const a=t[0],n=G.current.width,r=G.current.height,l=a.slice(468,473).map(e=>[e.x*n,e.y*r]);if(l.length<2)return B.current=null,void v(null);const c=l.length,s=l.reduce((e,t)=>{let[a]=t;return e+a},0)/c,i=l.reduce((e,t)=>{let[,a]=t;return e+a},0)/c;let u=0,m=0,d=0;l.forEach(e=>{let[t,a]=e;const n=t-s,r=a-i;u+=n*n,m+=n*r,d+=r*r});const g=(u/=c)+(d/=c),p=u*d-(m/=c)*m,h=g/2+Math.sqrt(Math.max(0,g*g/4-p)),E=2*Math.sqrt(h);if(E<2||E>40)return B.current=null,void v(null);B.current=E,v(E.toFixed(1))}async function q(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const a=[];for(let l=0;l<e;l++)await A(t),null!==B.current&&a.push(B.current);if(!a.length)return null;a.sort((e,t)=>e-t);const n=Math.floor(.1*a.length),r=a.slice(n,a.length-n);return r.length?r[Math.floor(r.length/2)]:a[Math.floor(a.length/2)]}Object(n.useEffect)(()=>{!async function(){try{console.log("Checking camera permission");const t=await navigator.permissions.query({name:"camera"});k("granted"===t.state),t.onchange=(()=>{k("granted"===t.state),console.log("Camera permission changed:",t.state)})}catch(e){console.error("Error checking camera permission:",e),k(!1)}}()},[]),Object(n.useEffect)(()=>{"initializing"===o&&x&&(console.log("Camera ready, transitioning to calibration"),s("calibration"))},[o,x]),Object(n.useEffect)(()=>{if("calibration"===o){console.log("Entered calibration step"),d({type:"initial",isTransitioning:!1});const e=setTimeout(async()=>{d({type:null,isTransitioning:!1}),await async function(){console.log("Checking calibration");let e=0;for(let t=0;t<10;t++)await A(100),null!==B.current&&e++;return console.log(`Calibration result: ${e}/10 valid detections`),e>=8}()?(console.log("Calibration successful, proceeding to testing"),s("testing")):(console.log("Calibration failed"),j("Unable to detect face reliably. Please ensure good lighting and face the camera directly."),I(),s("preparation"))},3e3);return()=>clearTimeout(e)}"testing"!==o||m.isTransitioning||(console.log("Starting test cycle",i+1),async function(e){if(m.isTransitioning)return void console.warn(`Cycle ${e+1} skipped due to ongoing transition`);console.log(`[${Date.now()}] Starting Cycle ${e+1}, overlayState=${m.type}`),B.current=null,v(null),d({type:"baseline",isTransitioning:!1}),console.log(`[${Date.now()}] Baseline ON, overlayState=baseline`),await A(a);const t=await q();d({type:null,isTransitioning:!1}),d({type:"flash",isTransitioning:!1}),console.log(`[${Date.now()}] Flash ON, overlayState=flash`),await A(c[e]-100);const n=await q(10,10);let r,o;await A(100),d({type:null,isTransitioning:!0}),console.log(`[${Date.now()}] Flash OFF, overlayState=null`),console.log(`Cycle ${e+1}: Baseline=${(null===t||void 0===t?void 0:t.toFixed(1))||"N/A"}, Constricted=${(null===n||void 0===n?void 0:n.toFixed(1))||"N/A"}`),t&&n&&t>=n?(r=(t-n).toFixed(1),o=((t-n)/t*100).toFixed(1)):(console.warn(`Invalid measurement in cycle ${e+1}: Baseline=${t}, Constricted=${n}`),r="\u2013",o="\u2013",j("Some measurements were invalid, possibly due to lighting, positioning, or camera issues. Please retry in a near-dark room, facing the camera directly.")),p(a=>[...a,{cycle:e+1,baseline:(null===t||void 0===t?void 0:t.toFixed(1))||"\u2013",constricted:(null===n||void 0===n?void 0:n.toFixed(1))||"\u2013",delta:r,percent:o}]),e+1<l.length?(u(e+1),d({type:"baseline",isTransitioning:!1}),console.log(`[${Date.now()}] Transition to Cycle ${e+2}, overlayState=baseline`)):(d({type:null,isTransitioning:!1}),I(),s("recall"))}(i))},[o,i]),Object(n.useEffect)(()=>()=>{d({type:null,isTransitioning:!1}),console.log(`[${Date.now()}] Cleanup: overlayState reset to null`)},[i]);const L=g.map(e=>parseFloat(e.percent)).filter(e=>!isNaN(e)),H=L.length?(L.reduce((e,t)=>e+t,0)/L.length).toFixed(1):null,_=Object(n.memo)(e=>{let{overlayState:t,cycleIndex:a,lightFlashIntensities:n,currentLiveDiameter:l,detectionWarning:c,baselineDotRadius:o}=e;return t.type?r.a.createElement("div",{className:"flash"===t.type?"full-flash-overlay":"full-black-overlay"},"flash"!==t.type&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"overlay-text"},"initial"===t.type&&"Preparing test...","baseline"===t.type&&`Cycle ${a+1} of ${n.length}: Focus`),r.a.createElement("div",{className:"ring-indicator"},r.a.createElement("div",{className:"pupil-dot",style:{width:o,height:o}})),l&&r.a.createElement("div",{className:"live-feedback"},l,"px"),c&&r.a.createElement("div",{className:"error-message"},c))):null});return r.a.createElement("div",{className:"pupil-test-container",ref:z},r.a.createElement("video",{ref:R,className:"hidden-video",playsInline:!0,muted:!0}),r.a.createElement(_,{overlayState:m,cycleIndex:i,lightFlashIntensities:l,currentLiveDiameter:y,detectionWarning:O,baselineDotRadius:80}),"intro"===o&&r.a.createElement("div",{className:"intro-step"},r.a.createElement("h2",null,"Pupillary Response Test"),r.a.createElement("div",{className:"memory-number"},M.current),r.a.createElement("p",null,"Remember this number for later recall"),r.a.createElement("button",{className:"primary-button",onClick:()=>s("preparation"),disabled:null===C||!C},"Continue"),!1===C&&r.a.createElement("div",{className:"error-message"},"Camera permission is required to proceed. Please grant camera access in your browser settings.")),"preparation"===o&&r.a.createElement("div",{className:"preparation-step"},r.a.createElement("h3",null,"Test Preparation"),r.a.createElement("ul",{className:"instructions"},r.a.createElement("li",null,"Ensure a near-dark room (turn off all room lights except the monitor)."),r.a.createElement("li",null,"Set your monitor brightness to the lowest comfortable level."),r.a.createElement("li",null,"Position yourself 50-60cm from your camera and face it directly."),r.a.createElement("li",null,"Keep your head still and avoid blinking during measurements."),r.a.createElement("li",null,"Focus on the central dot during the black screen and maintain focus throughout the test.")),D&&r.a.createElement("div",{className:"error-message"},D),r.a.createElement("button",{className:"primary-button start-button",onClick:async()=>{console.log("Begin Test clicked"),p([]),u(0),j(null),S(null),d({type:null,isTransitioning:!1}),s("initializing"),P.current=setTimeout(()=>{"initializing"!==o||x||(console.error("Camera initialization timed out"),j("Camera initialization took too long. Please ensure camera access and try again."),I(),s("preparation"))},5e3),await async function(){try{console.log("Initializing camera and FaceMesh");const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}}});$.current=t,R.current.srcObject=t,await R.current.play(),w(!0),console.log("Camera initialized successfully, video playing");const a=G.current;a.width=R.current.videoWidth,a.height=R.current.videoHeight;const n=new N.FaceMesh({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`});return n.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.8,minTrackingConfidence:.8}),n.onResults(W),T.current=n,requestAnimationFrame(F),!0}catch(e){return console.error("Camera initialization failed:",e),w(!1),j("Failed to access camera. Please ensure camera permissions are granted and try again."),!1}}()||(console.log("Initialization failed, returning to preparation"),clearTimeout(P.current),P.current=null,s("preparation"))}},"Begin Test")),"initializing"===o&&r.a.createElement("div",{className:"preparation-step"},r.a.createElement("h3",null,"Initializing Camera..."),r.a.createElement("p",null,"Please wait while the camera is set up."),D&&r.a.createElement("div",{className:"error-message"},D)),"testing"===o&&r.a.createElement("div",{className:"testing-step"}),"recall"===o&&r.a.createElement("div",{className:"recall-step"},r.a.createElement("h3",null,"Memory Recall"),r.a.createElement("p",null,"Please enter the number you were shown at the beginning of the test."),r.a.createElement("div",{className:"recall-task"},r.a.createElement("input",{type:"text",value:h,onChange:e=>E(e.target.value),placeholder:"Enter the number"}),r.a.createElement("button",{className:"primary-button",onClick:()=>{f(h===M.current.toString()),s("results")}},"Submit"))),"results"===o&&r.a.createElement("div",{className:"results-step"},r.a.createElement("h3",null,"Test Results"),D&&r.a.createElement("div",{className:"error-message"},D),r.a.createElement("div",{className:"metrics-grid"},g.map((e,t)=>r.a.createElement("div",{key:t,className:"metric-card"},r.a.createElement("h4",null,"Cycle ",e.cycle),r.a.createElement("div",{className:"metric-row"},r.a.createElement("span",null,"Baseline:"),r.a.createElement("span",null,e.baseline,"px")),r.a.createElement("div",{className:"metric-row"},r.a.createElement("span",null,"Constricted:"),r.a.createElement("span",null,e.constricted,"px")),r.a.createElement("div",{className:"metric-row highlight"},r.a.createElement("span",null,"Change:"),r.a.createElement("span",null,e.delta,"px (",e.percent,"%)"))))),H&&r.a.createElement("div",{className:"summary-card"},r.a.createElement("h4",null,"Average Pupil Constriction"),r.a.createElement("div",{className:"result-value"},H,"%"),r.a.createElement("div",{className:"interpretation"},r.a.createElement("p",null,r.a.createElement("strong",null,"Reference Range:")," A normal pupillary response typically shows an average constriction of 20\u201340%."),H>20?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,r.a.createElement("strong",null,"Normal Response:")," Your pupils constricted by an average of ",H,"%, which is within the typical range for healthy individuals."),r.a.createElement("p",null,"The Pupillary Light Response (PLR) test measures how your pupils react to light, which can be an early indicator of neurological health. A normal response suggests typical neurological function, but regular check-ups are recommended.")):H>10?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,r.a.createElement("strong",null,"Mild Reduction:")," Your pupils constricted by an average of ",H,"%, which is below the typical range."),r.a.createElement("p",null,"This may not indicate a problem, but reduced PLR can sometimes be associated with neurological conditions, including early Alzheimer's disease. We recommend discussing these results with a healthcare professional for further evaluation.")):r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,r.a.createElement("strong",null,"Significant Reduction:")," Your pupils constricted by an average of ",H,"%, which is significantly below the typical range."),r.a.createElement("p",null,"A reduced PLR may be an early sign of neurological issues, such as Alzheimer's disease, as the pupil's response to light can reflect brain function. Please consult a healthcare professional promptly to discuss these results and consider further testing.")),H<1&&r.a.createElement("p",null,r.a.createElement("strong",null,"Note:")," A very low constriction percentage may indicate measurement issues. Please ensure a near-dark room, direct camera facing, and focus on the central dot, then retry the test."),r.a.createElement("p",null,r.a.createElement("em",null,"Note: This test is for informational purposes only and is not a substitute for a medical diagnosis.")))),g.length>1&&L.length<g.length/2&&r.a.createElement("div",{className:"error-message"},"Multiple cycles failed to measure valid pupil responses. Please retry in a near-dark room with stable positioning."),r.a.createElement("div",{className:"recall-task"},r.a.createElement("h4",null,"Memory Recall Result"),null!==b&&r.a.createElement("div",{className:`feedback ${b?"correct":"incorrect"}`},b?"Correct!":`Incorrect (was ${M.current})`)),r.a.createElement("button",{className:"primary-button",onClick:()=>t("home")},"Complete Test")))}var D=function(){const[e,t]=Object(n.useState)("home");Object(n.useEffect)(()=>{"eye"!==e&&"realEye"!==e&&window.webgazer&&(console.log("[DEBUG] Clearing WebGazer instance (no .end() call)"),window.webgazer=null,console.log("[DEBUG] window.webgazer cleared."))},[e]);const a=e=>{t(e)};return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("h1",null,"\u8166\u53cb\u8a18 Cognitia"),r.a.createElement("p",null,"\u963f\u8332\u6d77\u9ed8\u75c7\u65e9\u671f\u6aa2\u6e2c AI \u7cfb\u7d71"),"home"!==e&&r.a.createElement("button",{onClick:()=>a("home"),className:"back-button"},"\u8fd4\u56de\u4e3b\u9801")),r.a.createElement("main",null,"home"===e&&r.a.createElement(o,{setCurrentTest:a}),"language"===e&&r.a.createElement(m,{setCurrentTest:a}),"hand"===e&&r.a.createElement(h,{setCurrentTest:a}),"eye"===e&&r.a.createElement(b,{setCurrentTest:a}),"realEye"===e&&r.a.createElement(C,{setCurrentTest:a}),"pupil"===e&&r.a.createElement(k,{setCurrentTest:a})),r.a.createElement("footer",{className:"App-footer"},r.a.createElement("p",null,"\xa9 2025 \u8166\u53cb\u8a18 Cognitia | \u4f7f\u7528\u5be6\u969b AI \u6280\u8853\u9032\u884c\u65e9\u671f\u8a8d\u77e5\u5065\u5eb7\u6aa2\u6e2c")))};var j=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,332)).then(t=>{let{getCLS:a,getFID:n,getFCP:r,getLCP:l,getTTFB:c}=t;a(e),n(e),r(e),l(e),c(e)})};c.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(D,null))),j()}},[[301,1,2]]]);
//# sourceMappingURL=main.1c2cefa1.chunk.js.map